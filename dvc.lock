schema: '2.0'
stages:
  structure_raw:
    cmd: python3 src/data/structure_raw.py
    deps:
    - path: data/raw/
      hash: md5
      md5: 6c3622ff98294a528208aece1e7ede8b.dir
      size: 21954635
      nfiles: 183
    - path: data/working_dataset.csv
      hash: md5
      md5: 02086bf6991f01344eccc4aba1935f1e
      size: 4542
    - path: dockers_started.txt
      hash: md5
      md5: 66a3ececd4a79201d7209f2a4dd1ce8f
      size: 29
    - path: params.yaml
      hash: md5
      md5: 8f3115d6562c1bd11cd06d45ba7e50df
      size: 3837
    - path: src/data/structure_raw.py
      hash: md5
      md5: 222e1cd8e683fb3b9a0cd5ffc0dcf882
      size: 3431
    outs:
    - path: data/raw_per_classes/
      hash: md5
      md5: f649d221b593c31f1d3a432966a87f42.dir
      size: 21954635
      nfiles: 183
  ingest:
    cmd: curl -X "POST" "http://localhost:8907/ingest"
    deps:
    - path: data/raw_per_classes/
      hash: md5
      md5: f649d221b593c31f1d3a432966a87f42.dir
      size: 21954635
      nfiles: 183
    - path: dockers_started.txt
      hash: md5
      md5: 66a3ececd4a79201d7209f2a4dd1ce8f
      size: 29
    - path: params.yaml
      hash: md5
      md5: 8f3115d6562c1bd11cd06d45ba7e50df
      size: 3837
    outs:
    - path: data/ocr_raw_per_classes/
      hash: md5
      md5: ff5eb92600b4ae1aebd4dd6e33148388.dir
      size: 174192
      nfiles: 183
  clean:
    cmd: curl -X "POST" "http://localhost:8907/clean"
    deps:
    - path: data/ocr_raw_per_classes/
      hash: md5
      md5: ff5eb92600b4ae1aebd4dd6e33148388.dir
      size: 174192
      nfiles: 183
    - path: dockers_started.txt
      hash: md5
      md5: 66a3ececd4a79201d7209f2a4dd1ce8f
      size: 29
    - path: params.yaml
      hash: md5
      md5: 8f3115d6562c1bd11cd06d45ba7e50df
      size: 3837
    outs:
    - path: data/cleaned_per_classes/
      hash: md5
      md5: 823b3d5b63415dd00a7ff1b92317b088.dir
      size: 113336
      nfiles: 3
  preprocessing:
    cmd: curl -X "POST" "http://localhost:8904/process"
    deps:
    - path: data/cleaned_per_classes/
      hash: md5
      md5: 823b3d5b63415dd00a7ff1b92317b088.dir
      size: 113336
      nfiles: 3
    - path: dockers_started.txt
      hash: md5
      md5: 66a3ececd4a79201d7209f2a4dd1ce8f
      size: 29
    - path: params.yaml
      hash: md5
      md5: 8f3115d6562c1bd11cd06d45ba7e50df
      size: 3837
    outs:
    - path: data/processed
      hash: md5
      md5: b2ddbe793ceff402f9e27f38fd1300d8.dir
      size: 3109546
      nfiles: 4
    - path: models/vectorizers
      hash: md5
      md5: 5656e9294f3e5bf074e8b91d99efbe57.dir
      size: 2528790
      nfiles: 1
  train:
    cmd: curl -X "POST" "http://localhost:8905/train"
    deps:
    - path: data/processed/train
      hash: md5
      md5: f5305281b34cd483487b5753ed698900.dir
      size: 2666549
      nfiles: 2
    - path: dockers_started.txt
      hash: md5
      md5: 66a3ececd4a79201d7209f2a4dd1ce8f
      size: 29
    - path: params.yaml
      hash: md5
      md5: 8f3115d6562c1bd11cd06d45ba7e50df
      size: 3837
    outs:
    - path: models/train
      hash: md5
      md5: 0ba51e5626d291f2d23af0798b6d03b1.dir
      size: 1682517
      nfiles: 1
  eval:
    cmd: curl -X "POST" "http://localhost:8906/eval"
    deps:
    - path: data/processed/test
      hash: md5
      md5: 7f488040020fe0c48d593401cce53e3c.dir
      size: 442997
      nfiles: 2
    - path: dockers_started.txt
      hash: md5
      md5: 66a3ececd4a79201d7209f2a4dd1ce8f
      size: 29
    - path: models/train
      hash: md5
      md5: 0ba51e5626d291f2d23af0798b6d03b1.dir
      size: 1682517
      nfiles: 1
    - path: params.yaml
      hash: md5
      md5: 8f3115d6562c1bd11cd06d45ba7e50df
      size: 3837
    outs:
    - path: metrics/confusion_matrix.json
      hash: md5
      md5: f576bad495523900c31298f19bebfccf
      size: 75
    - path: metrics/scores.json
      hash: md5
      md5: fcc40d96c499c49894e03a6555f8e2b9
      size: 399
  env_mlops_sake:
    cmd: python3 src/config_transform_as_env.py && python src/smart_merge_.env_.env_mlops_sake.py
    deps:
    - path: params.yaml
      hash: md5
      md5: 8f3115d6562c1bd11cd06d45ba7e50df
      size: 3837
    - path: src/config_transform_as_env.py
      hash: md5
      md5: d0ac128f1cc32185ebfd4bf959cf5c5f
      size: 3292
    - path: src/smart_merge_.env_.env_mlops_sake.py
      hash: md5
      md5: 6bed625e4211981d683d924f6852b605
      size: 1389
    outs:
    - path: .env_mlops_sake
      hash: md5
      md5: 505fae9f84cb431717311f4c57751db2
      size: 3701
    - path: .env_plantUML
      hash: md5
      md5: 16b569d10c92a27e1726e2163ffd0d25
      size: 4347
  start_docker:
    cmd: source scripts/docker_clean_dangling_images.sh && docker-compose stop &&
      docker-compose up --build -d && date > dockers_started.txt
    deps:
    - path: .env_mlops_sake
      hash: md5
      md5: 776596d2261abe1b4b67767b11fd5029
      size: 3145
    - path: docker-compose.yaml
      hash: md5
      md5: f37199e1292c0ab4441dc2be39068619
      size: 5500
    outs:
    - path: dockers_started.txt
      hash: md5
      md5: b0064df85e6e6daf47115f32ff29f6c6
      size: 29
  start_dockers:
    cmd: source scripts/docker_clean_dangling_images.sh && docker-compose stop &&
      docker-compose --profile training up --build -d && date > dockers_started.txt
    deps:
    - path: .env_mlops_sake
      hash: md5
      md5: 505fae9f84cb431717311f4c57751db2
      size: 3701
    - path: docker-compose.yaml
      hash: md5
      md5: 496c2edccd0e896eec5655553aa4e61b
      size: 6976
    outs:
    - path: dockers_started.txt
      hash: md5
      md5: 66a3ececd4a79201d7209f2a4dd1ce8f
      size: 29
